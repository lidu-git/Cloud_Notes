
<!-- saved from url=(0036)http://localhost:8080/cloudnote/type -->
<html lang="zh"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>码云主页</title>
<link href="./类别管理_files/note.css" rel="stylesheet">
<link href="./类别管理_files/bootstrap.css" rel="stylesheet">
<link href="./类别管理_files/sweetalert2.min.css" rel="stylesheet">
<script src="./类别管理_files/jquery-3.3.1.min.js"></script>
<script src="./类别管理_files/bootstrap.js"></script>
<script src="./类别管理_files/sweetalert2.min.js"></script>
<!-- 配置文件 -->
<script type="text/javascript" src="./类别管理_files/ueditor.config.js"></script>
<!-- 编辑器源码文件 -->
<script type="text/javascript" src="./类别管理_files/ueditor.all.js"></script>
<style type="text/css">
  body {
       padding-top: 60px;
       padding-bottom: 40px;
       background: url(./类别管理_files/bg.gif) repeat;
     }
</style>
</head>
<body>
<nav class="navbar navbar-inverse navbar-fixed-top">
  <div class="container-fluid">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" style="font-size:25px" href="http://localhost:8080/cloudnote/main">码云笔记</a>
    </div>
    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">
        <li class="active"><a href="http://localhost:8080/cloudnote/main"><i class="glyphicon glyphicon-cloud"></i>&nbsp;主&nbsp;&nbsp;页</a></li>
        <li><a href="http://localhost:8080/cloudnote/note"><i class="glyphicon glyphicon-pencil"></i>&nbsp;发表云记</a></li>
        <li><a href="http://localhost:8080/cloudnote/type"><i class="glyphicon glyphicon-list"></i>&nbsp;类别管理</a></li>
        <li><a href="http://localhost:8080/cloudnote/user"><i class="glyphicon glyphicon-user"></i>&nbsp;个人中心</a>
       
      </li></ul>
      <form class="navbar-form navbar-right" role="search" action="http://localhost:8080/cloudnote/main">
        <div class="form-group">
          <input type="hidden" name="act" value="searchKey">
          <input type="text" name="val" class="form-control" placeholder="搜索云记">
        </div>
        <button type="submit" class="btn btn-default">查询</button>
      </form>      
    </div>
  </div>
</nav>
<div class="container">
	<div class="row-fluid">
		<div class="col-md-3">
			<div class="data_list">
				<div class="data_list_title"><span class="glyphicon glyphicon-user"></span>&nbsp;个人中心&nbsp;&nbsp;&nbsp;&nbsp;<a href="http://localhost:8080/cloudnote/logout">退出</a></div>
				<div class="userimg">
					<img src="./类别管理_files/h2.jpg">
				</div>
				<div class="nick">我思故我在</div>
				<div class="mood">(以后的你会感谢现在努力的你)</div>
			</div>	
			<div class="data_list">
				<div class="data_list_title">
					<span class="glyphicon glyphicon-calendar">
					</span>&nbsp;云记日期 
				</div>
				
				<div>
					<ul class="nav nav-pills nav-stacked">
					 
						<li><a href="http://localhost:8080/cloudnote/main?act=searchDate&amp;val=2016%E5%B9%B408%E6%9C%88&amp;valStr=2016%E5%B9%B408%E6%9C%88">2016年08月 <span class="badge">24</span></a></li>
					 
						<li><a href="http://localhost:8080/cloudnote/main?act=searchDate&amp;val=2016%E5%B9%B407%E6%9C%88&amp;valStr=2016%E5%B9%B407%E6%9C%88">2016年07月 <span class="badge">1</span></a></li>
					 
						<li><a href="http://localhost:8080/cloudnote/main?act=searchDate&amp;val=2016%E5%B9%B406%E6%9C%88&amp;valStr=2016%E5%B9%B406%E6%9C%88">2016年06月 <span class="badge">1</span></a></li>
					 
					</ul>						
				</div>
				
			</div>		
			<div class="data_list">
				<div class="data_list_title">
					<span class="glyphicon glyphicon-list-alt">
					</span>&nbsp;云记类别 
				</div>
				
				<div>
					<ul class="nav nav-pills nav-stacked">
					 
						<li><a href="http://localhost:8080/cloudnote/main?act=searchType&amp;val=5&amp;valStr=test">test <span class="badge">0</span></a></li>
					 
						<li><a href="http://localhost:8080/cloudnote/main?act=searchType&amp;val=3&amp;valStr=%E5%B0%9A%E5%AD%A6%E5%A0%82%E7%AC%94%E8%AE%B0">码云笔记 <span class="badge">12</span></a></li>
					 
						<li><a href="http://localhost:8080/cloudnote/main?act=searchType&amp;val=2&amp;valStr=%E6%8A%80%E6%9C%AF">技术 <span class="badge">5</span></a></li>
					 
						<li><a href="http://localhost:8080/cloudnote/main?act=searchType&amp;val=4&amp;valStr=%E8%80%81%E8%A3%B4%E8%AF%AD%E5%BD%95">java <span class="badge">9</span></a></li>
					 
					</ul>						
				</div>
				
			</div>			
		</div>
	</div>
	<div class="col-md-9">
		

<div class="data_list">
	<div class="data_list_title">
		<span class="glyphicon glyphicon-list"></span>&nbsp;类型列表
		<span class="noteType_add">
			<button class="btn btn-sm btn-success" type="button" id="addBtn">添加类别</button>
		</span>
		
	 </div>
	<div>
	 	<table class="table table-hover table-striped ">
	 		<tbody><tr>
	 			<th>编号</th>
	 			<th>类型</th>
	 			<th>操作</th>
	 		</tr>
		
	 			
	 		<tr>
	 			<td>2</td>
	 			<td>技术</td>
	 			<td>
	 			<button class="btn btn-primary" type="button">修改</button>&nbsp;
	 			<button class="btn btn-danger del" type="button">删除</button>
	 			</td>
	 		</tr>
	 			
	 		<tr>
	 			<td>3</td>
	 			<td>码云笔记</td>
	 			<td>
	 			<button class="btn btn-primary" type="button">修改</button>&nbsp;
	 			<button class="btn btn-danger del" type="button">删除</button>
	 			</td>
	 		</tr>
	 			
	 		<tr>
	 			<td>4</td>
	 			<td>java</td>
	 			<td>
	 			<button class="btn btn-primary" type="button">修改</button>&nbsp;
	 			<button class="btn btn-danger del" type="button">删除</button>
	 			</td>
	 		</tr>
	 			
	 		<tr>
	 			<td>5</td>
	 			<td>test</td>
	 			<td>
	 			<button class="btn btn-primary" type="button">修改</button>&nbsp;
	 			<button class="btn btn-danger del" type="button">删除</button>
	 			</td>
	 		</tr>
	 			 	
		
		</tbody></table>
	</div>	
</div>
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">×</span></button>
          <h4 class="modal-title" id="myModalLabel">新增</h4>
        </div>
        <div class="modal-body"> 
          <div class="form-group">
            <label for="typename">类型名称</label>
            <input type="hidden" name="typeId"> 
            <input type="text" name="typename" class="form-control" id="typename" placeholder="类型名称">         	
          </div>      
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">
          <span class="glyphicon glyphicon-remove"></span>关闭</button>
          <button type="button" id="btn_submit" class="btn btn-primary">
          <span class="glyphicon glyphicon-floppy-disk"></span>保存</button>
        </div>
      </div>
    </div>
  </div>

 <script>
 	$(
 		function(){ 			
 			//显示模态窗口
 			$("#addBtn").click(
 				function(){
 					$("#myModalLabel").text("新增");
 				    $('#myModal').modal();
 				    $("input[name='typeId']").val('');
 				   $('#typename').val('');
 				} 				
 			); 	
 			
 			//确保本人的类型唯一
 			var target=$('#typename'); 
 			//获取焦点可用状态
 			target.focus(
 					function(){
 						$('#btn_submit').html('保存').removeClass("btn-danger").addClass("btn-info").attr('disabled',false);
 					}
 				);
 			//使用ajax验证
 			target.blur(
 				function(){
 					var val =target.val(); //获取值 					
 					if(val.length==0){
 						return;
 					}
 					$.getJSON("type",{
 						act:'unique',
 						typename:val
 					},function(data){
 						if(data.resultCode==-1){
 							$('#btn_submit').html('名称已存在').removeClass("btn-primary").addClass("btn-danger").attr('disabled',true);
 						}else{
 							$('#btn_submit').html('保存').removeClass("btn-danger").addClass("btn-info").attr('disabled',false);
 							
 						}
 					});
 				}		
 			);
 			
 			//保存数据
 			$('#btn_submit').click(
 				function(){
 					var idVal =$("input[name='typeId']").val();
 					$.getJSON("type",{
 						act:'save',
 						typename:$('#typename').val(),
 						typeId:idVal
 					},function(data){
 						//追加一行
 						if(data.resultCode==1){
 							if(idVal.length==0){ //新增
	 							var noteType =data.result;
	 							var tr="<tr><td>"+noteType.typeId+"</td>";
	 							tr +="<td>"+noteType.typeName+"</td>";
	 							tr +="<td><button class=\"btn btn-primary\" type=\"button\">修改</button>&nbsp;";
	 							tr +="<button class=\"btn btn-danger\" type=\"button\">删除</button></td></tr>";
	 							//追加到当前表格中
	 							//$(“.table”).filter(“.table-hover”).filter(“.table-striped”)
	 							//$("[class='table table-hover table-striped']");
	 							$(".table.table-hover.table-striped").append(tr);
	 								 
 							}else{ //修改
 								//遍历表格
 								var targetTr ;
 								$("table tr:gt(0)").each(function(i){
 								    $(this).children("td:eq(0)").each(function(i){
 								        if($(this).text()==idVal){
 								        	targetTr=$(this).parent();
 								        	return false;
 								        }
 								    });
 								});
 								targetTr.children('td').eq(1).html($('#typename').val());
 							}
 							//隐藏模态窗口
 							$('#myModal').modal('hide');
 						}
 					});
 				}		
 			);
 			
 			//修改  
 			//$(".table tr td:nth-child(2)").addClass('red');
 			//$(this).children('td').eq(1).addClass('red');
 			//1、绑定所有修改按钮事件
 			$('.table').on('click','.btn-primary',function(){
 				//2、获取对应的值  typeId typeName
 				var tr=$(this).parent().parent();
 				var typeId=tr.children('td').eq(0).text();
 				var typeName=tr.children('td').eq(1).text();
 				
 				//3、显示模态窗口
 				$("#myModalLabel").text("修改");
				$('#myModal').modal();	
				//4、按钮重置样式
				$('#btn_submit').html('保存').removeClass("btn-danger").addClass("btn-info").attr('disabled',true);
				//5、填充值
				$('#typename').val(typeName);
				$("input[name='typeId']").val(typeId);
 			});
 			
 			
 			//删除 1、绑定所有修改按钮事件
 			$('.table').on('click','.btn-danger',function(){
 				//2、获取对应的值  typeId typeName
 				var tr=$(this).parent().parent();
 				var typeId=tr.children('td').eq(0).text();
 				var typeName=tr.children('td').eq(1).text();
 				//3、使用sweet-alert
 				swal({title: "操作提示",   //弹出框的title
 				       text: "确定删除【"+typeName+"】吗？",  //弹出框里面的提示文本
 				       type: "warning",    //弹出框类型
 				       showCancelButton: true, //是否显示取消按钮
 				       confirmButtonColor: "#DD6B55",//确定按钮颜色
 				       cancelButtonText: "取消",//取消按钮文本
 				       confirmButtonText: "是的，确定删除！"//确定按钮上面的文档
 				     }).then(function(isConfirm) {
 				    	  if (isConfirm === true) { 
 				    		    $.getJSON("type",{
 		 	 						act:'del',
 		 	 						typeId:typeId
 		 	 					},function(data){
 		 	 						if(data.resultCode==1){
 		 	 							swal('操作成功!','已成功删除数据','success');
 		 	 							//移除tr
 		 	 							var targetTr ;
 		 								$("table tr:gt(0)").each(function(i){
 		 								    $(this).children("td:eq(0)").each(function(i){
 		 								        if($(this).text()==typeId){
 		 								        	targetTr=$(this).parent();
 		 								        	return false;
 		 								        }
 		 								    });
 		 								});
 		 								targetTr.remove();
 		 	 						}else if(data.resultCode==0){
 		 	 							swal('操作失败!','存在子记录不能删除','error'); 		 	 							
 		 	 						}else{
 		 	 							swal('操作失败!','未知问题','error'); 		
 		 	 						}
 		 	 					}); 
 				    		  
 				    		  }
 				    }); 
 			});
 		}	
 	);
 </script>
	</div>		
</div>

<div class="swal2-container"><div class="swal2-overlay" tabindex="-1"></div><div class="swal2-modal" style="display: none" tabindex="-1"><div class="swal2-icon swal2-error"><span class="x-mark"><span class="line left"></span><span class="line right"></span></span></div><div class="swal2-icon swal2-question">?</div><div class="swal2-icon swal2-warning">!</div><div class="swal2-icon swal2-info">i</div><div class="swal2-icon swal2-success"><span class="line tip"></span> <span class="line long"></span><div class="placeholder"></div> <div class="fix"></div></div><img class="swal2-image"><h2></h2><div class="swal2-content"></div><input class="swal2-input"><select class="swal2-select"></select><div class="swal2-radio"></div><label for="swal2-checkbox" class="swal2-checkbox"><input type="checkbox" id="swal2-checkbox"></label><textarea class="swal2-textarea"></textarea><div class="swal2-validationerror"></div><hr class="swal2-spacer"><button class="swal2-confirm">OK</button><button class="swal2-cancel">Cancel</button><span class="swal2-close">×</span></div></div></body></html>